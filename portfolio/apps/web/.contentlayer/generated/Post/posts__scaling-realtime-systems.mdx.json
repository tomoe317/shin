{
  "title": "Scaling Real-Time Systems: Lessons from Production",
  "summary": "Practical insights from scaling WebSocket infrastructure to handle 10,000+ concurrent connections with sub-100ms latency.",
  "tags": [
    "Backend",
    "WebSockets",
    "Scalability",
    "Architecture"
  ],
  "publishedAt": "2024-09-22T00:00:00.000Z",
  "published": true,
  "body": {
    "raw": "\n## Introduction\n\nReal-time systems are deceptively hard to scale. What works for 100 users breaks at 1,000. What works at 1,000 falls apart at 10,000. This post shares lessons learned from scaling a WebSocket-based collaboration platform from prototype to production.\n\n## The Journey\n\n### Phase 1: Single Server (0-500 users)\n\n**Architecture:**\n- Single Node.js server\n- In-memory state\n- Direct WebSocket connections\n\n**Works until:** ~500 concurrent connections\n\n**Why it breaks:**\n- Memory exhausted\n- CPU bottleneck\n- Single point of failure\n\n### Phase 2: Vertical Scaling (500-2,000 users)\n\n**Changes:**\n- Bigger server (32 CPU, 64GB RAM)\n- PM2 cluster mode\n- Redis for shared state\n\n**Works until:** ~2,000 concurrent connections\n\n**Why it breaks:**\n- Cost explodes ($1,000+/month)\n- Still single point of failure\n- Connection limits hit\n\n### Phase 3: Horizontal Scaling (2,000-10,000+ users)\n\n**Final Architecture:**\n\n```\n                    ┌──────────────┐\n                    │ Load Balancer│\n                    │  (Sticky IP) │\n                    └──────┬───────┘\n                           │\n       ┌───────────────────┼───────────────────┐\n       ▼                   ▼                   ▼\n┌──────────────┐    ┌──────────────┐    ┌──────────────┐\n│ WS Server 1  │    │ WS Server 2  │    │ WS Server 3  │\n└──────┬───────┘    └──────┬───────┘    └──────┬───────┘\n       │                   │                   │\n       └───────────────────┼───────────────────┘\n                           ▼\n                    ┌──────────────┐\n                    │ Redis Pub/Sub│\n                    └──────────────┘\n```\n\n## Key Patterns\n\n### 1. Sticky Sessions\n\nCritical for WebSocket scaling:\n\n```nginx\n# nginx config\nupstream websocket {\n  ip_hash;  # Stick to same server\n  server ws1.example.com:3000;\n  server ws2.example.com:3000;\n  server ws3.example.com:3000;\n}\n```\n\nWhy? WebSocket connections are stateful. Reconnecting to a different server loses context.\n\n### 2. Redis Pub/Sub for Cross-Server Communication\n\n```typescript\n// Server 1 receives message\nwss.on('connection', (ws) => {\n  ws.on('message', (data) => {\n    // Publish to all servers\n    redis.publish('messages', JSON.stringify({\n      userId: ws.userId,\n      data,\n    }));\n  });\n});\n\n// All servers subscribe\nredis.subscribe('messages');\nredis.on('message', (channel, message) => {\n  const { userId, data } = JSON.parse(message);\n\n  // Broadcast to local connections\n  wss.clients.forEach((client) => {\n    if (client.userId !== userId) {\n      client.send(data);\n    }\n  });\n});\n```\n\n**Gotcha:** Don't send to yourself! Filter by user ID.\n\n### 3. Health Checks and Graceful Shutdown\n\n```typescript\n// Health endpoint\napp.get('/health', (req, res) => {\n  const health = {\n    uptime: process.uptime(),\n    connections: wss.clients.size,\n    memory: process.memoryUsage(),\n    status: 'healthy',\n  };\n\n  res.json(health);\n});\n\n// Graceful shutdown\nprocess.on('SIGTERM', async () => {\n  console.log('SIGTERM received, closing server...');\n\n  // Stop accepting new connections\n  server.close();\n\n  // Close existing connections gracefully\n  for (const client of wss.clients) {\n    client.close(1001, 'Server shutting down');\n  }\n\n  // Wait for cleanup\n  await redis.quit();\n\n  process.exit(0);\n});\n```\n\n### 4. Backpressure Handling\n\nPrevent overwhelming clients:\n\n```typescript\nws.on('message', async (data) => {\n  // Check if client can receive\n  if (ws.bufferedAmount > THRESHOLD) {\n    console.warn('Client backpressure detected');\n\n    // Drop message or queue\n    return;\n  }\n\n  // Process and send\n  const response = await processMessage(data);\n  ws.send(response);\n});\n```\n\n### 5. Connection Monitoring\n\nTrack connections per server:\n\n```typescript\nconst metrics = {\n  connectionsTotal: 0,\n  connectionsCurrent: 0,\n  messagesPerSecond: 0,\n};\n\nwss.on('connection', (ws) => {\n  metrics.connectionsTotal++;\n  metrics.connectionsCurrent = wss.clients.size;\n\n  // Report to monitoring\n  statsd.gauge('ws.connections', metrics.connectionsCurrent);\n\n  ws.on('close', () => {\n    metrics.connectionsCurrent = wss.clients.size;\n    statsd.gauge('ws.connections', metrics.connectionsCurrent);\n  });\n});\n\n// Message rate tracking\nsetInterval(() => {\n  statsd.gauge('ws.messages_per_sec', messageCount / 10);\n  messageCount = 0;\n}, 10000);\n```\n\n## Performance Optimizations\n\n### 1. Message Batching\n\n```typescript\nconst messageQueue: Message[] = [];\nlet flushTimeout: NodeJS.Timeout;\n\nfunction queueMessage(msg: Message) {\n  messageQueue.push(msg);\n\n  if (!flushTimeout) {\n    flushTimeout = setTimeout(flushMessages, 16); // ~60 FPS\n  }\n}\n\nfunction flushMessages() {\n  if (messageQueue.length === 0) return;\n\n  const batch = messageQueue.splice(0, messageQueue.length);\n  broadcast(JSON.stringify(batch));\n\n  flushTimeout = null;\n}\n```\n\n**Impact:** 10x reduction in messages sent.\n\n### 2. Binary Messages\n\nUse binary for large payloads:\n\n```typescript\n// JSON (slow)\nws.send(JSON.stringify({ type: 'update', data: largeObject }));\n\n// Binary (fast)\nconst buffer = msgpack.encode({ type: 'update', data: largeObject });\nws.send(buffer);\n```\n\n**Impact:** 50% size reduction, 3x faster parsing.\n\n### 3. Compression\n\nEnable per-message deflate:\n\n```typescript\nconst wss = new WebSocketServer({\n  perMessageDeflate: {\n    zlibDeflateOptions: {\n      chunkSize: 1024,\n      memLevel: 7,\n      level: 3, // Fast compression\n    },\n  },\n});\n```\n\n**Trade-off:** CPU for bandwidth. Worth it on slow connections.\n\n## Lessons Learned\n\n1. **Start with vertical scaling** - Easier to manage initially\n2. **Add metrics early** - You can't optimize what you don't measure\n3. **Test failure modes** - What happens when Redis dies?\n4. **Graceful degradation** - System should work (degraded) when WebSockets fail\n5. **Load test before scaling** - Find bottlenecks at 1x load, not 10x\n\n## Costs\n\nFor 10,000 concurrent users:\n\n- **Compute:** 3x EC2 c5.2xlarge (~$600/mo)\n- **Redis:** ElastiCache m5.large (~$150/mo)\n- **Load Balancer:** ALB (~$30/mo)\n- **Bandwidth:** ~$200/mo\n- **Total:** ~$1,000/mo ($0.10/user/mo)\n\nCompare to Socket.io Cloud: ~$5,000/mo for same scale.\n\n## Tooling\n\nEssential tools:\n\n- **Load testing:** Artillery, k6\n- **Monitoring:** Datadog, CloudWatch\n- **Profiling:** Clinic.js, Chrome DevTools\n- **Debugging:** Wireshark for packet analysis\n\n## Conclusion\n\nScaling real-time systems requires rethinking traditional web architectures. Plan for horizontal scaling early, invest in monitoring, and test failure modes religiously.\n\nThe reward? A system that feels magical to users—instant, collaborative, alive.\n\nQuestions? [Reach out on LinkedIn](https://linkedin.com/in/roshankhatri)!\n",
    "code": "var Component=(()=>{var p=Object.create;var c=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var C=(e,l)=>()=>(l||e((l={exports:{}}).exports,l),l.exports),g=(e,l)=>{for(var r in l)c(e,r,{get:l[r],enumerable:!0})},a=(e,l,r,o)=>{if(l&&typeof l==\"object\"||typeof l==\"function\")for(let s of y(l))!A.call(e,s)&&s!==r&&c(e,s,{get:()=>l[s],enumerable:!(o=B(l,s))||o.enumerable});return e};var u=(e,l,r)=>(r=e!=null?p(F(e)):{},a(l||!e||!e.__esModule?c(r,\"default\",{value:e,enumerable:!0}):r,e)),E=e=>a(c({},\"__esModule\",{value:!0}),e);var t=C((S,i)=>{i.exports=_jsx_runtime});var f={};g(f,{default:()=>h,frontmatter:()=>m});var n=u(t()),m={title:\"Scaling Real-Time Systems: Lessons from Production\",summary:\"Practical insights from scaling WebSocket infrastructure to handle 10,000+ concurrent connections with sub-100ms latency.\",tags:[\"Backend\",\"WebSockets\",\"Scalability\",\"Architecture\"],publishedAt:\"2024-09-22\",published:!0};function d(e){let l={a:\"a\",code:\"code\",figure:\"figure\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.h2,{id:\"introduction\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#introduction\",children:\"Introduction\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Real-time systems are deceptively hard to scale. What works for 100 users breaks at 1,000. What works at 1,000 falls apart at 10,000. This post shares lessons learned from scaling a WebSocket-based collaboration platform from prototype to production.\"}),`\n`,(0,n.jsx)(l.h2,{id:\"the-journey\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#the-journey\",children:\"The Journey\"})}),`\n`,(0,n.jsx)(l.h3,{id:\"phase-1-single-server-0-500-users\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#phase-1-single-server-0-500-users\",children:\"Phase 1: Single Server (0-500 users)\"})}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Architecture:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Single Node.js server\"}),`\n`,(0,n.jsx)(l.li,{children:\"In-memory state\"}),`\n`,(0,n.jsx)(l.li,{children:\"Direct WebSocket connections\"}),`\n`]}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Works until:\"}),\" ~500 concurrent connections\"]}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Why it breaks:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Memory exhausted\"}),`\n`,(0,n.jsx)(l.li,{children:\"CPU bottleneck\"}),`\n`,(0,n.jsx)(l.li,{children:\"Single point of failure\"}),`\n`]}),`\n`,(0,n.jsx)(l.h3,{id:\"phase-2-vertical-scaling-500-2000-users\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#phase-2-vertical-scaling-500-2000-users\",children:\"Phase 2: Vertical Scaling (500-2,000 users)\"})}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Changes:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Bigger server (32 CPU, 64GB RAM)\"}),`\n`,(0,n.jsx)(l.li,{children:\"PM2 cluster mode\"}),`\n`,(0,n.jsx)(l.li,{children:\"Redis for shared state\"}),`\n`]}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Works until:\"}),\" ~2,000 concurrent connections\"]}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Why it breaks:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Cost explodes ($1,000+/month)\"}),`\n`,(0,n.jsx)(l.li,{children:\"Still single point of failure\"}),`\n`,(0,n.jsx)(l.li,{children:\"Connection limits hit\"}),`\n`]}),`\n`,(0,n.jsx)(l.h3,{id:\"phase-3-horizontal-scaling-2000-10000-users\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#phase-3-horizontal-scaling-2000-10000-users\",children:\"Phase 3: Horizontal Scaling (2,000-10,000+ users)\"})}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Final Architecture:\"})}),`\n`,(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{children:`                    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n                    \\u2502 Load Balancer\\u2502\n                    \\u2502  (Sticky IP) \\u2502\n                    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n                           \\u2502\n       \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n       \\u25BC                   \\u25BC                   \\u25BC\n\\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n\\u2502 WS Server 1  \\u2502    \\u2502 WS Server 2  \\u2502    \\u2502 WS Server 3  \\u2502\n\\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n       \\u2502                   \\u2502                   \\u2502\n       \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n                           \\u25BC\n                    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n                    \\u2502 Redis Pub/Sub\\u2502\n                    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n`})}),`\n`,(0,n.jsx)(l.h2,{id:\"key-patterns\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#key-patterns\",children:\"Key Patterns\"})}),`\n`,(0,n.jsx)(l.h3,{id:\"1-sticky-sessions\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#1-sticky-sessions\",children:\"1. Sticky Sessions\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Critical for WebSocket scaling:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"nginx\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"nginx\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"# nginx config\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"upstream\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" websocket {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  ip_hash\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";  \"}),(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"# Stick to same server\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" ws1.example.com:3000;\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" ws2.example.com:3000;\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" ws3.example.com:3000;\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,n.jsx)(l.p,{children:\"Why? WebSocket connections are stateful. Reconnecting to a different server loses context.\"}),`\n`,(0,n.jsx)(l.h3,{id:\"2-redis-pubsub-for-cross-server-communication\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#2-redis-pubsub-for-cross-server-communication\",children:\"2. Redis Pub/Sub for Cross-Server Communication\"})}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Server 1 receives message\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'connection'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'message'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"    // Publish to all servers\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"publish\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'messages'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"stringify\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    }));\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// All servers subscribe\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"subscribe\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'messages'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'message'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"channel\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" { \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" } \"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"=\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"parse\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Broadcast to local connections\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"forEach\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"((\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"    if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"userId\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" !==\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"      client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Gotcha:\"}),\" Don't send to yourself! Filter by user ID.\"]}),`\n`,(0,n.jsx)(l.h3,{id:\"3-health-checks-and-graceful-shutdown\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#3-health-checks-and-graceful-shutdown\",children:\"3. Health Checks and Graceful Shutdown\"})}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Health endpoint\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"app\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"get\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'/health'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"req\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"res\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" health\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    uptime\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"uptime\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(),\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    connections\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"size\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    memory\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"memoryUsage\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(),\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    status\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'healthy'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  };\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  res\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"json\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"health\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Graceful shutdown\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'SIGTERM'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"async\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" () \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  console\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"log\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'SIGTERM received, closing server...'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Stop accepting new connections\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"close\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Close existing connections gracefully\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  for\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" client\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" of\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"close\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1001\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'Server shutting down'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Wait for cleanup\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  await\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"quit\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"exit\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(l.h3,{id:\"4-backpressure-handling\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#4-backpressure-handling\",children:\"4. Backpressure Handling\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Prevent overwhelming clients:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'message'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"async\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Check if client can receive\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"bufferedAmount\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" >\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THRESHOLD\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    console\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"warn\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'Client backpressure detected'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"    // Drop message or queue\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"    return\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Process and send\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" response\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" await\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" processMessage\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"response\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(l.h3,{id:\"5-connection-monitoring\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#5-connection-monitoring\",children:\"5. Connection Monitoring\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Track connections per server:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  connectionsTotal\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  messagesPerSecond\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"};\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'connection'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsTotal\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"++\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"size\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Report to monitoring\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  statsd\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"gauge\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'ws.connections'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'close'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", () \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"size\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    statsd\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"gauge\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'ws.connections'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Message rate tracking\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"setInterval\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(() \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  statsd\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"gauge\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'ws.messages_per_sec'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"messageCount\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" /\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 10\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  messageCount\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}, \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"10000\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,n.jsx)(l.h2,{id:\"performance-optimizations\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#performance-optimizations\",children:\"Performance Optimizations\"})}),`\n`,(0,n.jsx)(l.h3,{id:\"1-message-batching\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#1-message-batching\",children:\"1. Message Batching\"})}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"[] \"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"=\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" [];\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"let\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"NodeJS\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Timeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" queueMessage\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"msg\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"push\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"msg\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"!\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" setTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"flushMessages\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"16\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"); \"}),(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// ~60 FPS\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" flushMessages\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"length\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" ===\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"return\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" batch\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"splice\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"length\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"  broadcast\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"stringify\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"batch\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"));\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" null\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Impact:\"}),\" 10x reduction in messages sent.\"]}),`\n`,(0,n.jsx)(l.h3,{id:\"2-binary-messages\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#2-binary-messages\",children:\"2. Binary Messages\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Use binary for large payloads:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// JSON (slow)\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"stringify\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({ \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"type\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'update'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"largeObject\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" }));\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Binary (fast)\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" buffer\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" msgpack\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"encode\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({ \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"type\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'update'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"largeObject\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" });\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"buffer\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Impact:\"}),\" 50% size reduction, 3x faster parsing.\"]}),`\n`,(0,n.jsx)(l.h3,{id:\"3-compression\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#3-compression\",children:\"3. Compression\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Enable per-message deflate:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" WebSocketServer\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  perMessageDeflate\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    zlibDeflateOptions\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      chunkSize\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1024\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      memLevel\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"7\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      level\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"3\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Fast compression\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    },\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  },\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Trade-off:\"}),\" CPU for bandwidth. Worth it on slow connections.\"]}),`\n`,(0,n.jsx)(l.h2,{id:\"lessons-learned\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#lessons-learned\",children:\"Lessons Learned\"})}),`\n`,(0,n.jsxs)(l.ol,{children:[`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Start with vertical scaling\"}),\" - Easier to manage initially\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Add metrics early\"}),\" - You can't optimize what you don't measure\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Test failure modes\"}),\" - What happens when Redis dies?\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Graceful degradation\"}),\" - System should work (degraded) when WebSockets fail\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Load test before scaling\"}),\" - Find bottlenecks at 1x load, not 10x\"]}),`\n`]}),`\n`,(0,n.jsx)(l.h2,{id:\"costs\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#costs\",children:\"Costs\"})}),`\n`,(0,n.jsx)(l.p,{children:\"For 10,000 concurrent users:\"}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Compute:\"}),\" 3x EC2 c5.2xlarge (~$600/mo)\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Redis:\"}),\" ElastiCache m5.large (~$150/mo)\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Load Balancer:\"}),\" ALB (~$30/mo)\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Bandwidth:\"}),\" ~$200/mo\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Total:\"}),\" ~$1,000/mo ($0.10/user/mo)\"]}),`\n`]}),`\n`,(0,n.jsx)(l.p,{children:\"Compare to Socket.io Cloud: ~$5,000/mo for same scale.\"}),`\n`,(0,n.jsx)(l.h2,{id:\"tooling\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#tooling\",children:\"Tooling\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Essential tools:\"}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Load testing:\"}),\" Artillery, k6\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Monitoring:\"}),\" Datadog, CloudWatch\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Profiling:\"}),\" Clinic.js, Chrome DevTools\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Debugging:\"}),\" Wireshark for packet analysis\"]}),`\n`]}),`\n`,(0,n.jsx)(l.h2,{id:\"conclusion\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#conclusion\",children:\"Conclusion\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Scaling real-time systems requires rethinking traditional web architectures. Plan for horizontal scaling early, invest in monitoring, and test failure modes religiously.\"}),`\n`,(0,n.jsx)(l.p,{children:\"The reward? A system that feels magical to users\\u2014instant, collaborative, alive.\"}),`\n`,(0,n.jsxs)(l.p,{children:[\"Questions? \",(0,n.jsx)(l.a,{href:\"https://linkedin.com/in/roshankhatri\",children:\"Reach out on LinkedIn\"}),\"!\"]})]})}function h(e={}){let{wrapper:l}=e.components||{};return l?(0,n.jsx)(l,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}return E(f);})();\n;return Component;"
  },
  "_id": "posts/scaling-realtime-systems.mdx",
  "_raw": {
    "sourceFilePath": "posts/scaling-realtime-systems.mdx",
    "sourceFileName": "scaling-realtime-systems.mdx",
    "sourceFileDir": "posts",
    "contentType": "mdx",
    "flattenedPath": "posts/scaling-realtime-systems"
  },
  "type": "Post",
  "slug": "scaling-realtime-systems",
  "readingTime": {
    "text": "4 min read",
    "minutes": 3.91,
    "time": 234600,
    "words": 782
  }
}