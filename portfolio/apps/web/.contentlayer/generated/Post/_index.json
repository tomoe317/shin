[
  {
    "title": "Building Performant 3D Experiences on the Web",
    "summary": "A deep dive into optimizing Three.js applications for production, covering rendering techniques, memory management, and mobile performance.",
    "tags": [
      "WebGL",
      "Performance",
      "Three.js",
      "Tutorial"
    ],
    "publishedAt": "2024-10-15T00:00:00.000Z",
    "published": true,
    "body": {
      "raw": "\n## Introduction\n\nWebGL and Three.js have democratized 3D graphics on the web, but building performant 3D experiences that work across devices remains challenging. After shipping multiple production 3D applications, I've learned valuable lessons about optimization that I want to share.\n\n## The Performance Budget\n\nBefore diving into techniques, establish your performance budget:\n\n- **Target:** 60 FPS (16.67ms per frame)\n- **Budget breakdown:**\n  - JavaScript: 3-4ms\n  - Rendering: 8-10ms\n  - Browser work: 3-4ms\n  - Buffer: 2ms\n\nMonitor these with Chrome DevTools Performance tab.\n\n## Optimization Techniques\n\n### 1. Instanced Rendering\n\nRendering thousands of similar objects? Use `InstancedMesh`:\n\n```typescript\n// ❌ Bad: Individual meshes\nconst meshes = [];\nfor (let i = 0; i < 10000; i++) {\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.set(x, y, z);\n  scene.add(mesh);\n  meshes.push(mesh);\n}\n\n// ✅ Good: Instanced mesh\nconst instancedMesh = new THREE.InstancedMesh(\n  geometry,\n  material,\n  10000\n);\n\nfor (let i = 0; i < 10000; i++) {\n  matrix.setPosition(x, y, z);\n  instancedMesh.setMatrixAt(i, matrix);\n}\n\ninstancedMesh.instanceMatrix.needsUpdate = true;\nscene.add(instancedMesh);\n```\n\n**Impact:** 100x fewer draw calls, 10x faster rendering.\n\n### 2. Geometry Optimization\n\nReduce vertex count aggressively:\n\n```typescript\n// Use LOD (Level of Detail)\nconst lod = new THREE.LOD();\n\n// High detail (close)\nlod.addLevel(highPolyMesh, 0);\n\n// Medium detail\nlod.addLevel(mediumPolyMesh, 50);\n\n// Low detail (far)\nlod.addLevel(lowPolyMesh, 200);\n\nscene.add(lod);\n```\n\nAlso consider:\n- BufferGeometry instead of Geometry\n- Merge static geometries\n- Use indexed geometries\n\n### 3. Texture Atlasing\n\nCombine textures to reduce draw calls:\n\n```typescript\n// Create atlas\nconst canvas = document.createElement('canvas');\ncanvas.width = 2048;\ncanvas.height = 2048;\nconst ctx = canvas.getContext('2d')!;\n\n// Pack textures\ntextures.forEach((img, i) => {\n  ctx.drawImage(img, x, y, w, h);\n});\n\nconst atlasTexture = new THREE.CanvasTexture(canvas);\n```\n\nDon't forget to update UVs!\n\n### 4. Frustum Culling\n\nThree.js does this automatically, but you can optimize further:\n\n```typescript\n// Manual culling for custom objects\nconst frustum = new THREE.Frustum();\nconst cameraViewProjectionMatrix = new THREE.Matrix4();\n\nfunction updateFrustum() {\n  camera.updateMatrixWorld();\n  cameraViewProjectionMatrix.multiplyMatrices(\n    camera.projectionMatrix,\n    camera.matrixWorldInverse\n  );\n  frustum.setFromProjectionMatrix(cameraViewProjectionMatrix);\n}\n\nfunction isVisible(object: THREE.Object3D) {\n  return frustum.intersectsObject(object);\n}\n```\n\n### 5. Shader Optimization\n\nMove calculations to vertex shader when possible:\n\n```glsl\n// ❌ Fragment shader (runs per pixel)\nvarying vec3 vNormal;\nvoid main() {\n  vec3 light = normalize(vec3(1.0, 1.0, 1.0));\n  float intensity = max(dot(vNormal, light), 0.0);\n  gl_FragColor = vec4(vec3(intensity), 1.0);\n}\n\n// ✅ Vertex shader (runs per vertex)\nattribute vec3 normal;\nvarying float vIntensity;\nvoid main() {\n  vec3 light = normalize(vec3(1.0, 1.0, 1.0));\n  vIntensity = max(dot(normal, light), 0.0);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n```\n\n## Mobile-Specific Optimizations\n\nMobile GPUs are less powerful—adapt accordingly:\n\n```typescript\nconst isMobile = /iPhone|iPad|Android/i.test(navigator.userAgent);\n\nconst config = {\n  shadowMapEnabled: !isMobile,\n  antialias: !isMobile,\n  pixelRatio: Math.min(window.devicePixelRatio, isMobile ? 2 : 3),\n  maxParticles: isMobile ? 5000 : 50000,\n};\n\nconst renderer = new THREE.WebGLRenderer({\n  antialias: config.antialias,\n  powerPreference: 'high-performance',\n});\n\nrenderer.setPixelRatio(config.pixelRatio);\nrenderer.shadowMap.enabled = config.shadowMapEnabled;\n```\n\n## Memory Management\n\nDispose properly to avoid memory leaks:\n\n```typescript\nfunction dispose(object: THREE.Object3D) {\n  object.traverse((child) => {\n    if (child instanceof THREE.Mesh) {\n      child.geometry.dispose();\n\n      if (Array.isArray(child.material)) {\n        child.material.forEach(m => m.dispose());\n      } else {\n        child.material.dispose();\n      }\n    }\n  });\n}\n\n// Clean up on unmount\nuseEffect(() => {\n  return () => {\n    dispose(scene);\n    renderer.dispose();\n  };\n}, []);\n```\n\n## Monitoring Performance\n\nTrack metrics in production:\n\n```typescript\nconst stats = {\n  fps: 0,\n  frameTime: 0,\n  memory: 0,\n};\n\nfunction measurePerformance() {\n  const start = performance.now();\n\n  renderer.render(scene, camera);\n\n  stats.frameTime = performance.now() - start;\n  stats.fps = 1000 / stats.frameTime;\n\n  // @ts-ignore\n  stats.memory = performance.memory?.usedJSHeapSize || 0;\n\n  // Send to analytics\n  if (stats.fps < 30) {\n    analytics.track('low_fps', stats);\n  }\n}\n```\n\n## Checklist\n\nBefore shipping:\n\n- [ ] Profile with Chrome DevTools\n- [ ] Test on low-end Android device\n- [ ] Measure memory usage over time\n- [ ] Verify 60 FPS on target devices\n- [ ] Add loading states\n- [ ] Implement fallback for unsupported devices\n- [ ] Respect prefers-reduced-motion\n\n## Resources\n\n- [Three.js Manual](https://threejs.org/manual/)\n- [WebGL Fundamentals](https://webglfundamentals.org/)\n- [GPU Gems (free online)](https://developer.nvidia.com/gpugems/gpugems/contributors)\n\n## Conclusion\n\n3D on the web is incredibly powerful, but requires discipline and optimization. Start with a performance budget, measure constantly, and optimize ruthlessly. Your users will thank you with longer sessions and better engagement.\n\nWhat optimization techniques have worked for you? [Let me know on Twitter](https://twitter.com/roshankhatri)!\n",
      "code": "var Component=(()=>{var p=Object.create;var c=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var C=(n,l)=>()=>(l||n((l={exports:{}}).exports,l),l.exports),E=(n,l)=>{for(var r in l)c(n,r,{get:l[r],enumerable:!0})},a=(n,l,r,o)=>{if(l&&typeof l==\"object\"||typeof l==\"function\")for(let s of y(l))!A.call(n,s)&&s!==r&&c(n,s,{get:()=>l[s],enumerable:!(o=B(l,s))||o.enumerable});return n};var m=(n,l,r)=>(r=n!=null?p(F(n)):{},a(l||!n||!n.__esModule?c(r,\"default\",{value:n,enumerable:!0}):r,n)),u=n=>a(c({},\"__esModule\",{value:!0}),n);var t=C((b,i)=>{i.exports=_jsx_runtime});var g={};E(g,{default:()=>h,frontmatter:()=>D});var e=m(t()),D={title:\"Building Performant 3D Experiences on the Web\",summary:\"A deep dive into optimizing Three.js applications for production, covering rendering techniques, memory management, and mobile performance.\",tags:[\"WebGL\",\"Performance\",\"Three.js\",\"Tutorial\"],publishedAt:\"2024-10-15\",published:!0};function d(n){let l={a:\"a\",code:\"code\",figure:\"figure\",h2:\"h2\",h3:\"h3\",input:\"input\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...n.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.h2,{id:\"introduction\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#introduction\",children:\"Introduction\"})}),`\n`,(0,e.jsx)(l.p,{children:\"WebGL and Three.js have democratized 3D graphics on the web, but building performant 3D experiences that work across devices remains challenging. After shipping multiple production 3D applications, I've learned valuable lessons about optimization that I want to share.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"the-performance-budget\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#the-performance-budget\",children:\"The Performance Budget\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Before diving into techniques, establish your performance budget:\"}),`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsxs)(l.li,{children:[(0,e.jsx)(l.strong,{children:\"Target:\"}),\" 60 FPS (16.67ms per frame)\"]}),`\n`,(0,e.jsxs)(l.li,{children:[(0,e.jsx)(l.strong,{children:\"Budget breakdown:\"}),`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"JavaScript: 3-4ms\"}),`\n`,(0,e.jsx)(l.li,{children:\"Rendering: 8-10ms\"}),`\n`,(0,e.jsx)(l.li,{children:\"Browser work: 3-4ms\"}),`\n`,(0,e.jsx)(l.li,{children:\"Buffer: 2ms\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(l.p,{children:\"Monitor these with Chrome DevTools Performance tab.\"}),`\n`,(0,e.jsx)(l.h2,{id:\"optimization-techniques\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#optimization-techniques\",children:\"Optimization Techniques\"})}),`\n`,(0,e.jsx)(l.h3,{id:\"1-instanced-rendering\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#1-instanced-rendering\",children:\"1. Instanced Rendering\"})}),`\n`,(0,e.jsxs)(l.p,{children:[\"Rendering thousands of similar objects? Use \",(0,e.jsx)(l.code,{children:\"InstancedMesh\"}),\":\"]}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// \\u274C Bad: Individual meshes\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" meshes\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" [];\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"for\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"let\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" i\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"; \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" <\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 10000\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"; \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"++\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" mesh\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"Mesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"geometry\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"material\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  mesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"position\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"set\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"y\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"z\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  scene\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"add\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"mesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  meshes\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"push\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"mesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// \\u2705 Good: Instanced mesh\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" instancedMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"InstancedMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  geometry\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  material\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"  10000\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"for\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"let\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" i\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"; \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" <\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 10000\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"; \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"++\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  matrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"setPosition\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"y\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"z\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  instancedMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"setMatrixAt\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"matrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"instancedMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"instanceMatrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"needsUpdate\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" true\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"scene\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"add\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"instancedMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,e.jsxs)(l.p,{children:[(0,e.jsx)(l.strong,{children:\"Impact:\"}),\" 100x fewer draw calls, 10x faster rendering.\"]}),`\n`,(0,e.jsx)(l.h3,{id:\"2-geometry-optimization\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#2-geometry-optimization\",children:\"2. Geometry Optimization\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Reduce vertex count aggressively:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Use LOD (Level of Detail)\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" lod\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"LOD\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// High detail (close)\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"lod\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"addLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"highPolyMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Medium detail\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"lod\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"addLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"mediumPolyMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"50\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Low detail (far)\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"lod\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"addLevel\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"lowPolyMesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"200\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"scene\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"add\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"lod\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"Also consider:\"}),`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:\"BufferGeometry instead of Geometry\"}),`\n`,(0,e.jsx)(l.li,{children:\"Merge static geometries\"}),`\n`,(0,e.jsx)(l.li,{children:\"Use indexed geometries\"}),`\n`]}),`\n`,(0,e.jsx)(l.h3,{id:\"3-texture-atlasing\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#3-texture-atlasing\",children:\"3. Texture Atlasing\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Combine textures to reduce draw calls:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Create atlas\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" canvas\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" document\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"createElement\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'canvas'\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"canvas\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"width\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 2048\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"canvas\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"height\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 2048\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" ctx\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" canvas\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"getContext\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'2d'\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"!\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Pack textures\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"textures\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"forEach\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"img\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ctx\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"drawImage\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"img\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"x\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"y\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"w\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"h\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" atlasTexture\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"CanvasTexture\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"canvas\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,e.jsx)(l.p,{children:\"Don't forget to update UVs!\"}),`\n`,(0,e.jsx)(l.h3,{id:\"4-frustum-culling\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#4-frustum-culling\",children:\"4. Frustum Culling\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Three.js does this automatically, but you can optimize further:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Manual culling for custom objects\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" frustum\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"Frustum\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" cameraViewProjectionMatrix\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"Matrix4\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" updateFrustum\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  camera\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"updateMatrixWorld\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  cameraViewProjectionMatrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"multiplyMatrices\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    camera\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"projectionMatrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    camera\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"matrixWorldInverse\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  );\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  frustum\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"setFromProjectionMatrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"cameraViewProjectionMatrix\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" isVisible\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Object3D\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  return\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" frustum\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"intersectsObject\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.h3,{id:\"5-shader-optimization\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#5-shader-optimization\",children:\"5. Shader Optimization\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Move calculations to vertex shader when possible:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"glsl\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"glsl\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// \\u274C Fragment shader (runs per pixel)\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"varying\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" vec3\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" vNormal;\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"void\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" main\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  vec3 light \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" normalize\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"vec3\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"));\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  float\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" intensity \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" max\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"dot\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(vNormal, light), \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  gl_FragColor \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" vec4\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"vec3\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(intensity), \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// \\u2705 Vertex shader (runs per vertex)\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"attribute\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" vec3\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" normal;\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"varying\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" float\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" vIntensity;\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"void\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" main\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  vec3 light \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" normalize\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"vec3\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"));\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  vIntensity \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" max\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"dot\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(normal, light), \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  gl_Position \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" projectionMatrix \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"*\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" modelViewMatrix \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"*\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" vec4\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(position, \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1.0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.h2,{id:\"mobile-specific-optimizations\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#mobile-specific-optimizations\",children:\"Mobile-Specific Optimizations\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Mobile GPUs are less powerful\\u2014adapt accordingly:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" isMobile\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" /iPhone\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"|\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"iPad\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"|\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"Android/\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"i\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"test\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"navigator\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"userAgent\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" config\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  shadowMapEnabled\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"!\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"isMobile\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  antialias\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"!\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"isMobile\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  pixelRatio\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Math\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"min\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"window\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"devicePixelRatio\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"isMobile\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" ?\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 2\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" :\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 3\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"),\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  maxParticles\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"isMobile\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" ?\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 5000\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" :\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 50000\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"};\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" renderer\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"WebGLRenderer\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  antialias\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"config\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"antialias\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  powerPreference\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'high-performance'\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"renderer\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"setPixelRatio\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"config\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"pixelRatio\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"renderer\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"shadowMap\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"enabled\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" config\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"shadowMapEnabled\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]})]})})}),`\n`,(0,e.jsx)(l.h2,{id:\"memory-management\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#memory-management\",children:\"Memory Management\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Dispose properly to avoid memory leaks:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" dispose\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Object3D\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  object\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"traverse\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"child\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"    if\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"child\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" instanceof\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THREE\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Mesh\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"      child\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"geometry\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"dispose\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"      if\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Array\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"isArray\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"child\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"material\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\")) {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"        child\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"material\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"forEach\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"m\"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" =>\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" m\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"dispose\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"());\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"      } \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"else\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"        child\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"material\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"dispose\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"      }\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    }\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Clean up on unmount\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"useEffect\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(() \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  return\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" () \"}),(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"    dispose\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"scene\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    renderer\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"dispose\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  };\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}, []);\"})})]})})}),`\n`,(0,e.jsx)(l.h2,{id:\"monitoring-performance\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#monitoring-performance\",children:\"Monitoring Performance\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Track metrics in production:\"}),`\n`,(0,e.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,e.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" stats\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  fps\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  frameTime\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  memory\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"};\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" measurePerformance\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" start\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" performance\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"now\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  renderer\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"render\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"scene\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"camera\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  stats\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"frameTime\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" performance\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"now\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() \"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"-\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" start\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  stats\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"fps\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 1000\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" /\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" stats\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"frameTime\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // @ts-ignore\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  stats\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"memory\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" performance\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"memory\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"?.\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"usedJSHeapSize\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" ||\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Send to analytics\"})}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"stats\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"fps\"}),(0,e.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" <\"}),(0,e.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 30\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(l.span,{\"data-line\":\"\",children:[(0,e.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    analytics\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"track\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'low_fps'\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"stats\"}),(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,e.jsx)(l.span,{\"data-line\":\"\",children:(0,e.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(l.h2,{id:\"checklist\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#checklist\",children:\"Checklist\"})}),`\n`,(0,e.jsx)(l.p,{children:\"Before shipping:\"}),`\n`,(0,e.jsxs)(l.ul,{className:\"contains-task-list\",children:[`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Profile with Chrome DevTools\"]}),`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Test on low-end Android device\"]}),`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Measure memory usage over time\"]}),`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Verify 60 FPS on target devices\"]}),`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Add loading states\"]}),`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Implement fallback for unsupported devices\"]}),`\n`,(0,e.jsxs)(l.li,{className:\"task-list-item\",children:[(0,e.jsx)(l.input,{type:\"checkbox\",disabled:!0}),\" \",\"Respect prefers-reduced-motion\"]}),`\n`]}),`\n`,(0,e.jsx)(l.h2,{id:\"resources\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#resources\",children:\"Resources\"})}),`\n`,(0,e.jsxs)(l.ul,{children:[`\n`,(0,e.jsx)(l.li,{children:(0,e.jsx)(l.a,{href:\"https://threejs.org/manual/\",children:\"Three.js Manual\"})}),`\n`,(0,e.jsx)(l.li,{children:(0,e.jsx)(l.a,{href:\"https://webglfundamentals.org/\",children:\"WebGL Fundamentals\"})}),`\n`,(0,e.jsx)(l.li,{children:(0,e.jsx)(l.a,{href:\"https://developer.nvidia.com/gpugems/gpugems/contributors\",children:\"GPU Gems (free online)\"})}),`\n`]}),`\n`,(0,e.jsx)(l.h2,{id:\"conclusion\",children:(0,e.jsx)(l.a,{className:\"anchor\",href:\"#conclusion\",children:\"Conclusion\"})}),`\n`,(0,e.jsx)(l.p,{children:\"3D on the web is incredibly powerful, but requires discipline and optimization. Start with a performance budget, measure constantly, and optimize ruthlessly. Your users will thank you with longer sessions and better engagement.\"}),`\n`,(0,e.jsxs)(l.p,{children:[\"What optimization techniques have worked for you? \",(0,e.jsx)(l.a,{href:\"https://twitter.com/roshankhatri\",children:\"Let me know on Twitter\"}),\"!\"]})]})}function h(n={}){let{wrapper:l}=n.components||{};return l?(0,e.jsx)(l,{...n,children:(0,e.jsx)(d,{...n})}):d(n)}return u(g);})();\n;return Component;"
    },
    "_id": "posts/performant-3d-web.mdx",
    "_raw": {
      "sourceFilePath": "posts/performant-3d-web.mdx",
      "sourceFileName": "performant-3d-web.mdx",
      "sourceFileDir": "posts",
      "contentType": "mdx",
      "flattenedPath": "posts/performant-3d-web"
    },
    "type": "Post",
    "slug": "performant-3d-web",
    "readingTime": {
      "text": "4 min read",
      "minutes": 3.42,
      "time": 205200,
      "words": 684
    }
  },
  {
    "title": "Scaling Real-Time Systems: Lessons from Production",
    "summary": "Practical insights from scaling WebSocket infrastructure to handle 10,000+ concurrent connections with sub-100ms latency.",
    "tags": [
      "Backend",
      "WebSockets",
      "Scalability",
      "Architecture"
    ],
    "publishedAt": "2024-09-22T00:00:00.000Z",
    "published": true,
    "body": {
      "raw": "\n## Introduction\n\nReal-time systems are deceptively hard to scale. What works for 100 users breaks at 1,000. What works at 1,000 falls apart at 10,000. This post shares lessons learned from scaling a WebSocket-based collaboration platform from prototype to production.\n\n## The Journey\n\n### Phase 1: Single Server (0-500 users)\n\n**Architecture:**\n- Single Node.js server\n- In-memory state\n- Direct WebSocket connections\n\n**Works until:** ~500 concurrent connections\n\n**Why it breaks:**\n- Memory exhausted\n- CPU bottleneck\n- Single point of failure\n\n### Phase 2: Vertical Scaling (500-2,000 users)\n\n**Changes:**\n- Bigger server (32 CPU, 64GB RAM)\n- PM2 cluster mode\n- Redis for shared state\n\n**Works until:** ~2,000 concurrent connections\n\n**Why it breaks:**\n- Cost explodes ($1,000+/month)\n- Still single point of failure\n- Connection limits hit\n\n### Phase 3: Horizontal Scaling (2,000-10,000+ users)\n\n**Final Architecture:**\n\n```\n                    ┌──────────────┐\n                    │ Load Balancer│\n                    │  (Sticky IP) │\n                    └──────┬───────┘\n                           │\n       ┌───────────────────┼───────────────────┐\n       ▼                   ▼                   ▼\n┌──────────────┐    ┌──────────────┐    ┌──────────────┐\n│ WS Server 1  │    │ WS Server 2  │    │ WS Server 3  │\n└──────┬───────┘    └──────┬───────┘    └──────┬───────┘\n       │                   │                   │\n       └───────────────────┼───────────────────┘\n                           ▼\n                    ┌──────────────┐\n                    │ Redis Pub/Sub│\n                    └──────────────┘\n```\n\n## Key Patterns\n\n### 1. Sticky Sessions\n\nCritical for WebSocket scaling:\n\n```nginx\n# nginx config\nupstream websocket {\n  ip_hash;  # Stick to same server\n  server ws1.example.com:3000;\n  server ws2.example.com:3000;\n  server ws3.example.com:3000;\n}\n```\n\nWhy? WebSocket connections are stateful. Reconnecting to a different server loses context.\n\n### 2. Redis Pub/Sub for Cross-Server Communication\n\n```typescript\n// Server 1 receives message\nwss.on('connection', (ws) => {\n  ws.on('message', (data) => {\n    // Publish to all servers\n    redis.publish('messages', JSON.stringify({\n      userId: ws.userId,\n      data,\n    }));\n  });\n});\n\n// All servers subscribe\nredis.subscribe('messages');\nredis.on('message', (channel, message) => {\n  const { userId, data } = JSON.parse(message);\n\n  // Broadcast to local connections\n  wss.clients.forEach((client) => {\n    if (client.userId !== userId) {\n      client.send(data);\n    }\n  });\n});\n```\n\n**Gotcha:** Don't send to yourself! Filter by user ID.\n\n### 3. Health Checks and Graceful Shutdown\n\n```typescript\n// Health endpoint\napp.get('/health', (req, res) => {\n  const health = {\n    uptime: process.uptime(),\n    connections: wss.clients.size,\n    memory: process.memoryUsage(),\n    status: 'healthy',\n  };\n\n  res.json(health);\n});\n\n// Graceful shutdown\nprocess.on('SIGTERM', async () => {\n  console.log('SIGTERM received, closing server...');\n\n  // Stop accepting new connections\n  server.close();\n\n  // Close existing connections gracefully\n  for (const client of wss.clients) {\n    client.close(1001, 'Server shutting down');\n  }\n\n  // Wait for cleanup\n  await redis.quit();\n\n  process.exit(0);\n});\n```\n\n### 4. Backpressure Handling\n\nPrevent overwhelming clients:\n\n```typescript\nws.on('message', async (data) => {\n  // Check if client can receive\n  if (ws.bufferedAmount > THRESHOLD) {\n    console.warn('Client backpressure detected');\n\n    // Drop message or queue\n    return;\n  }\n\n  // Process and send\n  const response = await processMessage(data);\n  ws.send(response);\n});\n```\n\n### 5. Connection Monitoring\n\nTrack connections per server:\n\n```typescript\nconst metrics = {\n  connectionsTotal: 0,\n  connectionsCurrent: 0,\n  messagesPerSecond: 0,\n};\n\nwss.on('connection', (ws) => {\n  metrics.connectionsTotal++;\n  metrics.connectionsCurrent = wss.clients.size;\n\n  // Report to monitoring\n  statsd.gauge('ws.connections', metrics.connectionsCurrent);\n\n  ws.on('close', () => {\n    metrics.connectionsCurrent = wss.clients.size;\n    statsd.gauge('ws.connections', metrics.connectionsCurrent);\n  });\n});\n\n// Message rate tracking\nsetInterval(() => {\n  statsd.gauge('ws.messages_per_sec', messageCount / 10);\n  messageCount = 0;\n}, 10000);\n```\n\n## Performance Optimizations\n\n### 1. Message Batching\n\n```typescript\nconst messageQueue: Message[] = [];\nlet flushTimeout: NodeJS.Timeout;\n\nfunction queueMessage(msg: Message) {\n  messageQueue.push(msg);\n\n  if (!flushTimeout) {\n    flushTimeout = setTimeout(flushMessages, 16); // ~60 FPS\n  }\n}\n\nfunction flushMessages() {\n  if (messageQueue.length === 0) return;\n\n  const batch = messageQueue.splice(0, messageQueue.length);\n  broadcast(JSON.stringify(batch));\n\n  flushTimeout = null;\n}\n```\n\n**Impact:** 10x reduction in messages sent.\n\n### 2. Binary Messages\n\nUse binary for large payloads:\n\n```typescript\n// JSON (slow)\nws.send(JSON.stringify({ type: 'update', data: largeObject }));\n\n// Binary (fast)\nconst buffer = msgpack.encode({ type: 'update', data: largeObject });\nws.send(buffer);\n```\n\n**Impact:** 50% size reduction, 3x faster parsing.\n\n### 3. Compression\n\nEnable per-message deflate:\n\n```typescript\nconst wss = new WebSocketServer({\n  perMessageDeflate: {\n    zlibDeflateOptions: {\n      chunkSize: 1024,\n      memLevel: 7,\n      level: 3, // Fast compression\n    },\n  },\n});\n```\n\n**Trade-off:** CPU for bandwidth. Worth it on slow connections.\n\n## Lessons Learned\n\n1. **Start with vertical scaling** - Easier to manage initially\n2. **Add metrics early** - You can't optimize what you don't measure\n3. **Test failure modes** - What happens when Redis dies?\n4. **Graceful degradation** - System should work (degraded) when WebSockets fail\n5. **Load test before scaling** - Find bottlenecks at 1x load, not 10x\n\n## Costs\n\nFor 10,000 concurrent users:\n\n- **Compute:** 3x EC2 c5.2xlarge (~$600/mo)\n- **Redis:** ElastiCache m5.large (~$150/mo)\n- **Load Balancer:** ALB (~$30/mo)\n- **Bandwidth:** ~$200/mo\n- **Total:** ~$1,000/mo ($0.10/user/mo)\n\nCompare to Socket.io Cloud: ~$5,000/mo for same scale.\n\n## Tooling\n\nEssential tools:\n\n- **Load testing:** Artillery, k6\n- **Monitoring:** Datadog, CloudWatch\n- **Profiling:** Clinic.js, Chrome DevTools\n- **Debugging:** Wireshark for packet analysis\n\n## Conclusion\n\nScaling real-time systems requires rethinking traditional web architectures. Plan for horizontal scaling early, invest in monitoring, and test failure modes religiously.\n\nThe reward? A system that feels magical to users—instant, collaborative, alive.\n\nQuestions? [Reach out on LinkedIn](https://linkedin.com/in/roshankhatri)!\n",
      "code": "var Component=(()=>{var p=Object.create;var c=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var C=(e,l)=>()=>(l||e((l={exports:{}}).exports,l),l.exports),g=(e,l)=>{for(var r in l)c(e,r,{get:l[r],enumerable:!0})},a=(e,l,r,o)=>{if(l&&typeof l==\"object\"||typeof l==\"function\")for(let s of y(l))!A.call(e,s)&&s!==r&&c(e,s,{get:()=>l[s],enumerable:!(o=B(l,s))||o.enumerable});return e};var u=(e,l,r)=>(r=e!=null?p(F(e)):{},a(l||!e||!e.__esModule?c(r,\"default\",{value:e,enumerable:!0}):r,e)),E=e=>a(c({},\"__esModule\",{value:!0}),e);var t=C((S,i)=>{i.exports=_jsx_runtime});var f={};g(f,{default:()=>h,frontmatter:()=>m});var n=u(t()),m={title:\"Scaling Real-Time Systems: Lessons from Production\",summary:\"Practical insights from scaling WebSocket infrastructure to handle 10,000+ concurrent connections with sub-100ms latency.\",tags:[\"Backend\",\"WebSockets\",\"Scalability\",\"Architecture\"],publishedAt:\"2024-09-22\",published:!0};function d(e){let l={a:\"a\",code:\"code\",figure:\"figure\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.h2,{id:\"introduction\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#introduction\",children:\"Introduction\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Real-time systems are deceptively hard to scale. What works for 100 users breaks at 1,000. What works at 1,000 falls apart at 10,000. This post shares lessons learned from scaling a WebSocket-based collaboration platform from prototype to production.\"}),`\n`,(0,n.jsx)(l.h2,{id:\"the-journey\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#the-journey\",children:\"The Journey\"})}),`\n`,(0,n.jsx)(l.h3,{id:\"phase-1-single-server-0-500-users\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#phase-1-single-server-0-500-users\",children:\"Phase 1: Single Server (0-500 users)\"})}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Architecture:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Single Node.js server\"}),`\n`,(0,n.jsx)(l.li,{children:\"In-memory state\"}),`\n`,(0,n.jsx)(l.li,{children:\"Direct WebSocket connections\"}),`\n`]}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Works until:\"}),\" ~500 concurrent connections\"]}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Why it breaks:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Memory exhausted\"}),`\n`,(0,n.jsx)(l.li,{children:\"CPU bottleneck\"}),`\n`,(0,n.jsx)(l.li,{children:\"Single point of failure\"}),`\n`]}),`\n`,(0,n.jsx)(l.h3,{id:\"phase-2-vertical-scaling-500-2000-users\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#phase-2-vertical-scaling-500-2000-users\",children:\"Phase 2: Vertical Scaling (500-2,000 users)\"})}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Changes:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Bigger server (32 CPU, 64GB RAM)\"}),`\n`,(0,n.jsx)(l.li,{children:\"PM2 cluster mode\"}),`\n`,(0,n.jsx)(l.li,{children:\"Redis for shared state\"}),`\n`]}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Works until:\"}),\" ~2,000 concurrent connections\"]}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Why it breaks:\"})}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsx)(l.li,{children:\"Cost explodes ($1,000+/month)\"}),`\n`,(0,n.jsx)(l.li,{children:\"Still single point of failure\"}),`\n`,(0,n.jsx)(l.li,{children:\"Connection limits hit\"}),`\n`]}),`\n`,(0,n.jsx)(l.h3,{id:\"phase-3-horizontal-scaling-2000-10000-users\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#phase-3-horizontal-scaling-2000-10000-users\",children:\"Phase 3: Horizontal Scaling (2,000-10,000+ users)\"})}),`\n`,(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:\"Final Architecture:\"})}),`\n`,(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{children:`                    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n                    \\u2502 Load Balancer\\u2502\n                    \\u2502  (Sticky IP) \\u2502\n                    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n                           \\u2502\n       \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n       \\u25BC                   \\u25BC                   \\u25BC\n\\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n\\u2502 WS Server 1  \\u2502    \\u2502 WS Server 2  \\u2502    \\u2502 WS Server 3  \\u2502\n\\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u252C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n       \\u2502                   \\u2502                   \\u2502\n       \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n                           \\u25BC\n                    \\u250C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2510\n                    \\u2502 Redis Pub/Sub\\u2502\n                    \\u2514\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2518\n`})}),`\n`,(0,n.jsx)(l.h2,{id:\"key-patterns\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#key-patterns\",children:\"Key Patterns\"})}),`\n`,(0,n.jsx)(l.h3,{id:\"1-sticky-sessions\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#1-sticky-sessions\",children:\"1. Sticky Sessions\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Critical for WebSocket scaling:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"nginx\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"nginx\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"# nginx config\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"upstream\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" websocket {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  ip_hash\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";  \"}),(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"# Stick to same server\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" ws1.example.com:3000;\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" ws2.example.com:3000;\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" ws3.example.com:3000;\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,n.jsx)(l.p,{children:\"Why? WebSocket connections are stateful. Reconnecting to a different server loses context.\"}),`\n`,(0,n.jsx)(l.h3,{id:\"2-redis-pubsub-for-cross-server-communication\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#2-redis-pubsub-for-cross-server-communication\",children:\"2. Redis Pub/Sub for Cross-Server Communication\"})}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Server 1 receives message\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'connection'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'message'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"    // Publish to all servers\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"publish\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'messages'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"stringify\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    }));\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// All servers subscribe\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"subscribe\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'messages'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'message'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"channel\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" { \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" } \"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"=\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"parse\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Broadcast to local connections\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"forEach\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"((\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"    if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"userId\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" !==\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" userId\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"      client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Gotcha:\"}),\" Don't send to yourself! Filter by user ID.\"]}),`\n`,(0,n.jsx)(l.h3,{id:\"3-health-checks-and-graceful-shutdown\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#3-health-checks-and-graceful-shutdown\",children:\"3. Health Checks and Graceful Shutdown\"})}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Health endpoint\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"app\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"get\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'/health'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"req\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"res\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" health\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    uptime\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"uptime\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(),\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    connections\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"size\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    memory\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"memoryUsage\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(),\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    status\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'healthy'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  };\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  res\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"json\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"health\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Graceful shutdown\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'SIGTERM'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"async\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" () \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  console\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"log\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'SIGTERM received, closing server...'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Stop accepting new connections\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  server\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"close\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Close existing connections gracefully\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  for\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" client\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" of\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    client\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"close\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1001\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'Server shutting down'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Wait for cleanup\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  await\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" redis\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"quit\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"();\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  process\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"exit\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(l.h3,{id:\"4-backpressure-handling\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#4-backpressure-handling\",children:\"4. Backpressure Handling\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Prevent overwhelming clients:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'message'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"async\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Check if client can receive\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"bufferedAmount\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" >\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" THRESHOLD\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    console\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"warn\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'Client backpressure detected'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"    // Drop message or queue\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"    return\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Process and send\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" response\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" await\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" processMessage\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"response\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(l.h3,{id:\"5-connection-monitoring\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#5-connection-monitoring\",children:\"5. Connection Monitoring\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Track connections per server:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  connectionsTotal\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  messagesPerSecond\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"};\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'connection'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", (\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsTotal\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"++\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"size\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"  // Report to monitoring\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  statsd\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"gauge\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'ws.connections'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"on\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'close'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", () \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"clients\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"size\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"    statsd\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"gauge\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'ws.connections'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"metrics\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"connectionsCurrent\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  });\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Message rate tracking\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"setInterval\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(() \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"=>\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  statsd\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"gauge\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'ws.messages_per_sec'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"messageCount\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" /\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 10\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  messageCount\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}, \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"10000\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,n.jsx)(l.h2,{id:\"performance-optimizations\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#performance-optimizations\",children:\"Performance Optimizations\"})}),`\n`,(0,n.jsx)(l.h3,{id:\"1-message-batching\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#1-message-batching\",children:\"1. Message Batching\"})}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"[] \"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"=\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" [];\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"let\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\" flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"NodeJS\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Timeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" queueMessage\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\",fontStyle:\"italic\"},children:\"msg\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"Message\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"  messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"push\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"msg\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\"!\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" setTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"flushMessages\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"16\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"); \"}),(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// ~60 FPS\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  }\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"function\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" flushMessages\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"() {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  if\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" (\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"length\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" ===\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" 0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\") \"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"return\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"  const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" batch\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"splice\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"0\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"messageQueue\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"length\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"  broadcast\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"stringify\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"batch\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"));\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  flushTimeout\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\" null\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\";\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Impact:\"}),\" 10x reduction in messages sent.\"]}),`\n`,(0,n.jsx)(l.h3,{id:\"2-binary-messages\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#2-binary-messages\",children:\"2. Binary Messages\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Use binary for large payloads:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// JSON (slow)\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"JSON\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"stringify\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({ \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"type\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'update'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"largeObject\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" }));\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Binary (fast)\"})}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" buffer\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" msgpack\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"encode\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({ \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"type\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#98C379\"},children:\"'update'\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"data\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"largeObject\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\" });\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\"ws\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\".\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\"send\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"(\"}),(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"buffer\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\");\"})]})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Impact:\"}),\" 50% size reduction, 3x faster parsing.\"]}),`\n`,(0,n.jsx)(l.h3,{id:\"3-compression\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#3-compression\",children:\"3. Compression\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Enable per-message deflate:\"}),`\n`,(0,n.jsx)(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(l.pre,{tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",children:(0,n.jsxs)(l.code,{\"data-language\":\"typescript\",\"data-theme\":\"one-dark-pro\",style:{display:\"grid\"},children:[(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\"const\"}),(0,n.jsx)(l.span,{style:{color:\"#E5C07B\"},children:\" wss\"}),(0,n.jsx)(l.span,{style:{color:\"#56B6C2\"},children:\" =\"}),(0,n.jsx)(l.span,{style:{color:\"#C678DD\"},children:\" new\"}),(0,n.jsx)(l.span,{style:{color:\"#61AFEF\"},children:\" WebSocketServer\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"({\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"  perMessageDeflate\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"    zlibDeflateOptions\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": {\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      chunkSize\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"1024\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      memLevel\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"7\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\",\"})]}),`\n`,(0,n.jsxs)(l.span,{\"data-line\":\"\",children:[(0,n.jsx)(l.span,{style:{color:\"#E06C75\"},children:\"      level\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\": \"}),(0,n.jsx)(l.span,{style:{color:\"#D19A66\"},children:\"3\"}),(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\", \"}),(0,n.jsx)(l.span,{style:{color:\"#7F848E\",fontStyle:\"italic\"},children:\"// Fast compression\"})]}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"    },\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"  },\"})}),`\n`,(0,n.jsx)(l.span,{\"data-line\":\"\",children:(0,n.jsx)(l.span,{style:{color:\"#ABB2BF\"},children:\"});\"})})]})})}),`\n`,(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:\"Trade-off:\"}),\" CPU for bandwidth. Worth it on slow connections.\"]}),`\n`,(0,n.jsx)(l.h2,{id:\"lessons-learned\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#lessons-learned\",children:\"Lessons Learned\"})}),`\n`,(0,n.jsxs)(l.ol,{children:[`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Start with vertical scaling\"}),\" - Easier to manage initially\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Add metrics early\"}),\" - You can't optimize what you don't measure\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Test failure modes\"}),\" - What happens when Redis dies?\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Graceful degradation\"}),\" - System should work (degraded) when WebSockets fail\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Load test before scaling\"}),\" - Find bottlenecks at 1x load, not 10x\"]}),`\n`]}),`\n`,(0,n.jsx)(l.h2,{id:\"costs\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#costs\",children:\"Costs\"})}),`\n`,(0,n.jsx)(l.p,{children:\"For 10,000 concurrent users:\"}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Compute:\"}),\" 3x EC2 c5.2xlarge (~$600/mo)\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Redis:\"}),\" ElastiCache m5.large (~$150/mo)\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Load Balancer:\"}),\" ALB (~$30/mo)\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Bandwidth:\"}),\" ~$200/mo\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Total:\"}),\" ~$1,000/mo ($0.10/user/mo)\"]}),`\n`]}),`\n`,(0,n.jsx)(l.p,{children:\"Compare to Socket.io Cloud: ~$5,000/mo for same scale.\"}),`\n`,(0,n.jsx)(l.h2,{id:\"tooling\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#tooling\",children:\"Tooling\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Essential tools:\"}),`\n`,(0,n.jsxs)(l.ul,{children:[`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Load testing:\"}),\" Artillery, k6\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Monitoring:\"}),\" Datadog, CloudWatch\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Profiling:\"}),\" Clinic.js, Chrome DevTools\"]}),`\n`,(0,n.jsxs)(l.li,{children:[(0,n.jsx)(l.strong,{children:\"Debugging:\"}),\" Wireshark for packet analysis\"]}),`\n`]}),`\n`,(0,n.jsx)(l.h2,{id:\"conclusion\",children:(0,n.jsx)(l.a,{className:\"anchor\",href:\"#conclusion\",children:\"Conclusion\"})}),`\n`,(0,n.jsx)(l.p,{children:\"Scaling real-time systems requires rethinking traditional web architectures. Plan for horizontal scaling early, invest in monitoring, and test failure modes religiously.\"}),`\n`,(0,n.jsx)(l.p,{children:\"The reward? A system that feels magical to users\\u2014instant, collaborative, alive.\"}),`\n`,(0,n.jsxs)(l.p,{children:[\"Questions? \",(0,n.jsx)(l.a,{href:\"https://linkedin.com/in/roshankhatri\",children:\"Reach out on LinkedIn\"}),\"!\"]})]})}function h(e={}){let{wrapper:l}=e.components||{};return l?(0,n.jsx)(l,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}return E(f);})();\n;return Component;"
    },
    "_id": "posts/scaling-realtime-systems.mdx",
    "_raw": {
      "sourceFilePath": "posts/scaling-realtime-systems.mdx",
      "sourceFileName": "scaling-realtime-systems.mdx",
      "sourceFileDir": "posts",
      "contentType": "mdx",
      "flattenedPath": "posts/scaling-realtime-systems"
    },
    "type": "Post",
    "slug": "scaling-realtime-systems",
    "readingTime": {
      "text": "4 min read",
      "minutes": 3.91,
      "time": 234600,
      "words": 782
    }
  }
]